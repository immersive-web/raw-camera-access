<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>WebXR Raw Camera Access Module</title>
  <meta content="CG-DRAFT" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version b25686b9f, updated Fri Mar 14 14:15:20 2025 -0700" name="generator">
  <link href="https://immersive-web.github.io/raw-camera-access/" rel="canonical">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>
  .non-normative::before {
    content: "This section is non-normative.";
    font-style: italic;
  }
  .non-normative-remainder::before {
    content: "The remainder of this section is non-normative.";
    font-style: italic;
  }
  .tg {
    border-collapse: collapse;
    border-spacing: 0;
  }
  .tg th {
    border-style: solid;
    border-width: 1px;
    background: #90b8de;
    color: #fff;
    font-family: sans-serif;
    font-weight: bold;
    border-color: grey;
  }
  .tg td {
    padding: 4px 5px;
    background-color: rgb(221, 238, 255);
    font-family: monospace;
    border-style: solid;
    border-width: 1px;
    border-color: grey;
    overflow: hidden;
    word-break: normal;
  }
  .unstable::before {
    content: "This section is not stable";
    display: block;
    font-weight: bold;
    text-align: right;
    color: red;
  }
  .unstable {
    border: thin solid pink;
    border-radius: .5em;
    padding: .5em;
    margin: .5em calc(-0.5em - 1px);
    background-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='300' height='290'><text transform='rotate(-45)' text-anchor='middle' font-family='sans-serif' font-weight='bold' font-size='70' y='210' opacity='.1'>Unstable</text></svg>");
    background-repeat: repeat;
    background-color: #FFF4F4;
  }
  .unstable h3:first-of-type {
    margin-top: 0.5rem;
  }
  .unstable.example:not(.no-marker)::before {
    content: "Example " counter(example) " (Unstable)";
    float: none;
  }
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-idl-highlighting */
pre.idl.highlight {
    background: var(--borderedblock-bg, var(--def-bg));
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">WebXR Raw Camera Access Module</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2025-05-21">21 May 2025</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://immersive-web.github.io/raw-camera-access/">https://immersive-web.github.io/raw-camera-access/</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/immersive-web/raw-camera-access/issues/">GitHub</a>
      <dd><a href="#issues-index">Inline In Spec</a>
      <dt class="editor">Editor:
      <dd class="editor p-author h-card vcard" data-editor-id="114716"><a class="p-name fn u-email email" href="mailto:alcooper@google.com">Alex Cooper</a> (<a class="p-org org" href="http://google.com/">Google</a>)
      <dt class="editor">Former Editor:
      <dd class="editor p-author h-card vcard" data-editor-id="114482"><a class="p-name fn u-email email" href="mailto:bialpio@google.com">Piotr Bialecki</a> (<a class="p-org org" href="https://google.com/">Google</a>)
      <dt>Participate:
      <dd><a href="https://github.com/immersive-web/raw-camera-access/issues/new">File an issue</a> (<a href="https://github.com/immersive-web/raw-camera-access/issues">open issues</a>)
      <dd><a href="https://lists.w3.org/Archives/Public/public-immersive-web/">Mailing list archive</a>
      <dd><a href="irc://irc.w3.org:6665/">W3C’s #immersive-web IRC</a>
      <dt>Explainer:
      <dd><a href="https://github.com/immersive-web/raw-camera-access/blob/main/explainer.md">explainer.md on GitHub</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2025 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification provides a means to access the raw camera image displayed behind an immerisve-ar session, when the device is responsible for rendering that camera image.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#terminology"><span class="secno">1.1</span> <span class="content">Terminology</span></a>
     </ol>
    <li>
     <a href="#initialization"><span class="secno">2</span> <span class="content">Initialization</span></a>
     <ol class="toc">
      <li><a href="#feature-descriptor"><span class="secno">2.1</span> <span class="content">Feature descriptor</span></a>
     </ol>
    <li>
     <a href="#accessing-camera-texture"><span class="secno">3</span> <span class="content">Accessing camera texture</span></a>
     <ol class="toc">
      <li><a href="#xr-view-section"><span class="secno">3.1</span> <span class="content">XRView</span></a>
      <li><a href="#xr-camera-section"><span class="secno">3.2</span> <span class="content">XRCamera</span></a>
      <li><a href="#xr-web-gl-binding-section"><span class="secno">3.3</span> <span class="content">XRWebGLBinding</span></a>
     </ol>
    <li>
     <a href="#native-device-concepts"><span class="secno">4</span> <span class="content">Native device concepts</span></a>
     <ol class="toc">
      <li><a href="#native-camera-section"><span class="secno">4.1</span> <span class="content">Native camera</span></a>
     </ol>
    <li>
     <a href="#privacy-security"><span class="secno">5</span> <span class="content">Privacy &amp; Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#user-experience"><span class="secno">5.1</span> <span class="content">User experience</span></a>
      <li><a href="#privacy-indicators"><span class="secno">5.2</span> <span class="content">Privacy indicators</span></a>
     </ol>
    <li><a href="#ack"><span class="secno">6</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <section class="non-normative">
    <p>This specification introduces new WebXR Device API capability, namely Raw Camera Access API. The newly introduced API enables WebXR-powered applications to access camera image pixels, allowing them to leverage this new information to compute custom per-frame visual effects, or take a snapshot of the app-rendered content overlaid with the camera image.</p>
    <p class="note" role="note"><span class="marker">Note:</span> The API shape specified in this document primarily solves the smartphone-centric scenarios. See <a href="https://github.com/immersive-web/raw-camera-access/issues/2">issue #2</a> for context.</p>
   </section>
   <h3 class="heading settled" data-level="1.1" id="terminology"><span class="secno">1.1. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h3>
   <p>This document uses the acronyms AR to signify Augmented Reality, and VR to signify Virtual Reality.</p>
   <h2 class="heading settled" data-level="2" id="initialization"><span class="secno">2. </span><span class="content">Initialization</span><a class="self-link" href="#initialization"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="feature-descriptor"><span class="secno">2.1. </span><span class="content">Feature descriptor</span><a class="self-link" href="#feature-descriptor"></a></h3>
   <p>The applications can request that raw camera access be enabled on an <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrsession-interface" id="ref-for-xrsession-interface">XRSession</a></code> by passing an appropriate <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#feature-descriptor" id="ref-for-feature-descriptor">feature descriptor</a>. This module introduces new string - <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="camera-access">camera-access</dfn>, as a new valid feature descriptor for raw camera access feature.</p>
   <p>A device is <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#capable-of-supporting" id="ref-for-capable-of-supporting">capable of supporting</a> the raw camera access feature if the device exposes <a data-link-type="dfn" href="#native-camera" id="ref-for-native-camera">native camera</a> capability. The <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#inline-xr-device" id="ref-for-inline-xr-device">inline XR device</a> MUST NOT be treated as <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#capable-of-supporting" id="ref-for-capable-of-supporting①">capable of supporting</a> the raw camera access feature.</p>
   <p>The raw camera access feature is subject to <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#permissions-policy" id="ref-for-permissions-policy">permissions policy</a> and requires <code>"xr-spatial-tracking"</code> policy to be allowed on the requesting document’s origin. In addition, the <code>"camera"</code> <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#permissions-policy" id="ref-for-permissions-policy①">permissions policy</a> must be allowed on the requesting document’s origin.</p>
   <div class="example" id="example-db4da1e5">
    <a class="self-link" href="#example-db4da1e5"></a> The following code demonstrates how a session that requires raw camera access API could be requested: 
<pre class="highlight"><c- a>const</c-> session <c- o>=</c-> <c- k>await</c-> navigator<c- p>.</c->xr<c- p>.</c->requestSession<c- p>(</c-><c- u>"immersive-ar"</c-><c- p>,</c-> <c- p>{</c->
  requiredFeatures<c- o>:</c-> <c- p>[</c-><c- u>"camera-access"</c-><c- p>],</c->
<c- p>});</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="3" id="accessing-camera-texture"><span class="secno">3. </span><span class="content">Accessing camera texture</span><a class="self-link" href="#accessing-camera-texture"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="xr-view-section"><span class="secno">3.1. </span><span class="content">XRView</span><a class="self-link" href="#xr-view-section"></a></h3>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface"><c- g>XRView</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject" id="ref-for-SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#xrcamera" id="ref-for-xrcamera"><c- n>XRCamera</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="XRView" data-dfn-type="attribute" data-export data-readonly data-type="XRCamera?" id="dom-xrview-camera"><code><c- g>camera</c-></code></dfn>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface①">XRView</a></code> is extended to contain a <code class="idl"><a data-link-type="idl" href="#dom-xrview-camera" id="ref-for-dom-xrview-camera">camera</a></code> attribute which refers to an <code class="idl"><a data-link-type="idl" href="#xrcamera" id="ref-for-xrcamera①">XRCamera</a></code> instance containing information about the camera image relevant for this view. When <code class="idl"><a data-link-type="idl" href="#dom-xrview-camera" id="ref-for-dom-xrview-camera①">camera</a></code> attribute is accessed for the first time on a given <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface②">XRView</a></code> instance, the user agent MUST run the <a data-link-type="dfn" href="#obtain-camera" id="ref-for-obtain-camera">obtain camera</a> algorithm. Subsequent accesses on the same <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface③">XRView</a></code> instance MUST result the same <code class="idl"><a data-link-type="idl" href="#xrcamera" id="ref-for-xrcamera②">XRCamera</a></code> instance if one was returned, or <code>null</code> otherwise.</p>
   <div class="algorithm" data-algorithm="obtain-camera">
    <p>In order to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-camera">obtain camera</dfn> for <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface④">XRView</a></code> <var>view</var>, the user agent MUST run the following steps:</p>
    <ol>
     <li data-md>
      <p>Let <var>session</var> be the <var>view</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrview-session" id="ref-for-xrview-session">session</a>.</p>
     <li data-md>
      <p>If <a data-link-type="dfn" href="#camera-access" id="ref-for-camera-access">camera-access</a> feature descriptor is not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain">contained</a> in the <var>session</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#set-of-granted-features" id="ref-for-set-of-granted-features">set of granted features</a>, return <code>null</code> and abort these steps.</p>
     <li data-md>
      <p>Let <var>frame</var> be the <var>view</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrview-frame" id="ref-for-xrview-frame">frame</a>.</p>
     <li data-md>
      <p>If <var>frame</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrframe-active" id="ref-for-xrframe-active">active</a> boolean is <code>false</code>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw">throw</a> an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code> and abort these steps.</p>
     <li data-md>
      <p>If <var>frame</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrframe-animationframe" id="ref-for-xrframe-animationframe">animationFrame</a> boolean is <code>false</code>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw①">throw</a> an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code> and abort these steps.</p>
     <li data-md>
      <p>Let <var>camera image</var> contain a camera image buffer of size <var>width</var> by <var>height</var> texels that was returned from <a data-link-type="dfn" href="#native-camera" id="ref-for-native-camera①">native camera</a> that is valid for <var>frame</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrframe-time" id="ref-for-xrframe-time">time</a>.</p>
     <li data-md>
      <p>If <var>camera image</var> is <code>null</code>, return <code>null</code> and abort these steps.</p>
     <li data-md>
      <p>Ensure that <var>camera image</var> contains data that is <a data-link-type="dfn" href="#aligned" id="ref-for-aligned">aligned</a> with the <var>view</var>, including adjusting <var>width</var> and <var>height</var> as appropriate. If that is not possible, return <code>null</code> and abort these steps.</p>
     <li data-md>
      <p>Invoke <a data-link-type="dfn" href="#create-camera-instance" id="ref-for-create-camera-instance">create camera instance</a> algorithm with <var>view</var>, <var>camera image</var>, <var>width</var> and <var>height</var> and return its result.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.2" id="xr-camera-section"><span class="secno">3.2. </span><span class="content">XRCamera</span><a class="self-link" href="#xr-camera-section"></a></h3>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext" id="ref-for-SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="xrcamera"><code><c- g>XRCamera</c-></code></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="XRCamera" data-dfn-type="attribute" data-export data-readonly data-type="unsigned long" id="dom-xrcamera-width"><code><c- g>width</c-></code></dfn>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long①"><c- b>unsigned</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="XRCamera" data-dfn-type="attribute" data-export data-readonly data-type="unsigned long" id="dom-xrcamera-height"><code><c- g>height</c-></code></dfn>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#xrcamera" id="ref-for-xrcamera③">XRCamera</a></code> interface is introduced as a way to expose information about the camera texture that can be obtained from <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/layers/#XRWebGLBindingtype" id="ref-for-XRWebGLBindingtype">XRWebGLBinding</a></code>.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#xrcamera" id="ref-for-xrcamera④">XRCamera</a></code> contains <code class="idl"><a data-link-type="idl" href="#dom-xrcamera-width" id="ref-for-dom-xrcamera-width">width</a></code> attribute that contains the width (in texels) of the <a data-link-type="dfn" href="#xrcamera-camera-image" id="ref-for-xrcamera-camera-image">camera image</a>.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="#xrcamera" id="ref-for-xrcamera⑤">XRCamera</a></code> contains <code class="idl"><a data-link-type="idl" href="#dom-xrcamera-height" id="ref-for-dom-xrcamera-height">height</a></code> attribute that contains the height (in texels) of the <a data-link-type="dfn" href="#xrcamera-camera-image" id="ref-for-xrcamera-camera-image①">camera image</a>.</p>
   <p>Each <code class="idl"><a data-link-type="idl" href="#xrcamera" id="ref-for-xrcamera⑥">XRCamera</a></code> has an associated <dfn class="dfn-paneled" data-dfn-for="XRCamera" data-dfn-type="dfn" data-noexport id="xrcamera-view">view</dfn> instance that contains the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface⑤">XRView</a></code> from which the <code class="idl"><a data-link-type="idl" href="#xrcamera" id="ref-for-xrcamera⑦">XRCamera</a></code> instance was returned.</p>
   <p>Each <code class="idl"><a data-link-type="idl" href="#xrcamera" id="ref-for-xrcamera⑧">XRCamera</a></code> has an associated <dfn class="dfn-paneled" data-dfn-for="XRCamera" data-dfn-type="dfn" data-noexport id="xrcamera-camera-image">camera image</dfn> data buffer.</p>
   <div class="algorithm" data-algorithm="create-camera">
     In order to <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="create camera instance" data-noexport id="create-camera-instance"> create camera instance</dfn> from <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface⑥">XRView</a></code> <var>view</var>, <var>camera image</var>, <var>width</var> and <var>height</var>, the user agent MUST run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>result</var> be a new instance of <code class="idl"><a data-link-type="idl" href="#xrcamera" id="ref-for-xrcamera⑨">XRCamera</a></code> interface.</p>
     <li data-md>
      <p>Set <var>result</var>’s <a data-link-type="dfn" href="#xrcamera-view" id="ref-for-xrcamera-view">view</a> to <var>view</var>.</p>
     <li data-md>
      <p>Set <var>result</var>’s <a data-link-type="dfn" href="#xrcamera-camera-image" id="ref-for-xrcamera-camera-image②">camera image</a> to <var>camera image</var>.</p>
     <li data-md>
      <p>Set <var>result</var>’s <code class="idl"><a data-link-type="idl" href="#dom-xrcamera-width" id="ref-for-dom-xrcamera-width①">width</a></code> to <var>width</var>.</p>
     <li data-md>
      <p>Set <var>result</var>’s <code class="idl"><a data-link-type="idl" href="#dom-xrcamera-height" id="ref-for-dom-xrcamera-height①">height</a></code> to <var>height</var>.</p>
     <li data-md>
      <p>Return <var>result</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="3.3" id="xr-web-gl-binding-section"><span class="secno">3.3. </span><span class="content">XRWebGLBinding</span><a class="self-link" href="#xr-web-gl-binding-section"></a></h3>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://immersive-web.github.io/layers/#XRWebGLBindingtype" id="ref-for-XRWebGLBindingtype①"><c- g>XRWebGLBinding</c-></a> {
  <a data-link-type="idl-name" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9" id="ref-for-5.9"><c- n>WebGLTexture</c-></a>? <dfn class="dfn-paneled idl-code" data-dfn-for="XRWebGLBinding" data-dfn-type="method" data-export data-lt="getCameraImage(camera)" id="dom-xrwebglbinding-getcameraimage"><code><c- g>getCameraImage</c-></code></dfn>(<a data-link-type="idl-name" href="#xrcamera" id="ref-for-xrcamera①⓪"><c- n>XRCamera</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="XRWebGLBinding/getCameraImage(camera)" data-dfn-type="argument" data-export id="dom-xrwebglbinding-getcameraimage-camera-camera"><code><c- g>camera</c-></code></dfn>);
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dom-xrwebglbinding-getcameraimage" id="ref-for-dom-xrwebglbinding-getcameraimage">getCameraImage(camera)</a></code> method, when invoked, can be used to <a data-link-type="dfn" href="#obtain-camera-image" id="ref-for-obtain-camera-image">obtain camera image</a> from an <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/layers/#XRWebGLBindingtype" id="ref-for-XRWebGLBindingtype②">XRWebGLBinding</a></code>. The returned <code class="idl"><a data-link-type="idl" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9" id="ref-for-5.9①">WebGLTexture</a></code>, if non-<code>null</code>, is an <a data-link-type="dfn" href="https://immersive-web.github.io/layers/#opaque-texture" id="ref-for-opaque-texture">opaque texture</a>.</p>
   <div class="algorithm" data-algorithm="obtain-camera-image">
     In order to <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="obtain-camera-image">obtain camera image</dfn> from <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/layers/#XRWebGLBindingtype" id="ref-for-XRWebGLBindingtype③">XRWebGLBinding</a></code> <var>binding</var>, for <code class="idl"><a data-link-type="idl" href="#xrcamera" id="ref-for-xrcamera①①">XRCamera</a></code> <var>camera</var>, the user agent MUST run the following steps: 
    <ol>
     <li data-md>
      <p>Let <var>session</var> be <var>binding</var>’s <a data-link-type="dfn" href="https://immersive-web.github.io/layers/#xrwebglbinding-session" id="ref-for-xrwebglbinding-session">session</a>.</p>
     <li data-md>
      <p>Let <var>view</var> be <var>camera</var>’s <a data-link-type="dfn" href="#xrcamera-view" id="ref-for-xrcamera-view①">view</a>.</p>
     <li data-md>
      <p>If <var>view</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrview-session" id="ref-for-xrview-session①">session</a> does not match <var>session</var>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw②">throw</a> an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror②">InvalidStateError</a></code> and abort these steps.</p>
     <li data-md>
      <p>Let <var>frame</var> be the <var>view</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrview-frame" id="ref-for-xrview-frame①">frame</a>.</p>
     <li data-md>
      <p>If <var>frame</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrframe-active" id="ref-for-xrframe-active①">active</a> boolean is <code>false</code>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw③">throw</a> an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror③">InvalidStateError</a></code> and abort these steps.</p>
     <li data-md>
      <p>If <var>frame</var>’s <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xrframe-animationframe" id="ref-for-xrframe-animationframe①">animationFrame</a> boolean is <code>false</code>, <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#dfn-throw" id="ref-for-dfn-throw④">throw</a> an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror④">InvalidStateError</a></code> and abort these steps.</p>
     <li data-md>
      <p>Let <var>context</var> be the <var>binding</var>’s <a data-link-type="dfn" href="https://immersive-web.github.io/layers/#xrwebglbinding-context" id="ref-for-xrwebglbinding-context">context</a>.</p>
     <li data-md>
      <p>Let <var>camera image</var> be the <var>camera</var>’s <a data-link-type="dfn" href="#xrcamera-camera-image" id="ref-for-xrcamera-camera-image③">camera image</a>.</p>
     <li data-md>
      <p>Let <var>result</var> be a <code class="idl"><a data-link-type="idl" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9" id="ref-for-5.9②">WebGLTexture</a></code> that was created on <var>context</var>, containing <var>camera image</var>’s data. <var>result</var> is an <a data-link-type="dfn" href="https://immersive-web.github.io/layers/#opaque-texture" id="ref-for-opaque-texture①">opaque texture</a>.</p>
     <li data-md>
      <p>Return <var>result</var>.</p>
    </ol>
   </div>
   <p>The user agent MAY cache the results of a call to <code class="idl"><a data-link-type="idl" href="#dom-xrwebglbinding-getcameraimage" id="ref-for-dom-xrwebglbinding-getcameraimage①">getCameraImage(camera)</a></code> to be returned for subsequent calls of the method, assuming that the cache is keyed by the binding and the camera instance. The user agent MUST perform initial validations even when using the cache by running up to step 6 (inclusive) of <a data-link-type="dfn" href="#obtain-camera-image" id="ref-for-obtain-camera-image①">obtain camera image</a> algorithm. Because this caching is permitted, the application SHOULD treat the returned <code class="idl"><a data-link-type="idl" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9" id="ref-for-5.9③">WebGLTexture</a></code> as read-only.</p>
   <p class="note" role="note"><span class="marker">Note:</span> caching is permitted because the user agent retains ownership of the lifetime of the returned <code class="idl"><a data-link-type="idl" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9" id="ref-for-5.9④">WebGLTexture</a></code> (since it’s considered an <a data-link-type="dfn" href="https://immersive-web.github.io/layers/#opaque-texture" id="ref-for-opaque-texture②">opaque texture</a>), and because calling this method multiple times within the same <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#requestanimationframe" id="ref-for-requestanimationframe">requestAnimationFrame()</a> callback (ensured by using <code class="idl"><a data-link-type="idl" href="#xrcamera" id="ref-for-xrcamera①②">XRCamera</a></code>, &amp; therefore <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrframe-interface" id="ref-for-xrframe-interface">XRFrame</a></code> transitively as a part of the cache key), on the same binding (ensured by using <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/layers/#XRWebGLBindingtype" id="ref-for-XRWebGLBindingtype④">XRWebGLBinding</a></code> as a part of the cache key), will result in textures with identical contents.</p>
   <p>If the <code class="idl"><a data-link-type="idl" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9" id="ref-for-5.9⑤">WebGLTexture</a></code> returned from a call to <code class="idl"><a data-link-type="idl" href="#dom-xrwebglbinding-getcameraimage" id="ref-for-dom-xrwebglbinding-getcameraimage②">getCameraImage(camera)</a></code> supports transparency, it MUST contain colors with premultiplied alpha.</p>
   <p class="issue" id="issue-63423cac"><a class="self-link" href="#issue-63423cac"></a> Should we specify more information about the returned <code class="idl"><a data-link-type="idl" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9" id="ref-for-5.9⑥">WebGLTexture</a></code>? E.g.: is color-renderable, what is the texture format, etc.</p>
   <h2 class="heading settled" data-level="4" id="native-device-concepts"><span class="secno">4. </span><span class="content">Native device concepts</span><a class="self-link" href="#native-device-concepts"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="native-camera-section"><span class="secno">4.1. </span><span class="content">Native camera</span><a class="self-link" href="#native-camera-section"></a></h3>
   <section class="non-normative">
    <p>Raw camera API specification assumes that the native device on top of which the API is implemented provides a way to access animation-frame-synchronized access to the camera image. Such a device is said to support a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="native-camera">native camera</dfn> capability.</p>
    <p>In addition for the device to being able to provide a camera image, the Raw Camera Access API can only provide camera image textures that are <a data-link-type="dfn" href="#aligned" id="ref-for-aligned①">aligned</a> with an <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface⑦">XRView</a></code> from which they are requested. The camera image is said to be <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="aligned">aligned</dfn> with the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface⑧">XRView</a></code> if the camera pose is the same as the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface⑨">XRView</a></code>’s pose, and the camera’s viewing frustum has the same shape as <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface①⓪">XRView</a></code>’s viewing frustum. If the camera image returned by the <a data-link-type="dfn" href="#native-camera" id="ref-for-native-camera②">native camera</a> covers a viewing frustum that entirely contains the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface①①">XRView</a></code>’s viewing frustum, the user agent can crop the camera image as long as the operation causes the viewing frustum shapes to match exactly.</p>
   </section>
   <h2 class="heading settled" data-level="5" id="privacy-security"><span class="secno">5. </span><span class="content">Privacy &amp; Security Considerations</span><a class="self-link" href="#privacy-security"></a></h2>
   <section class="non-normative">
    <p>The Raw Camera Access API has the highest privacy implications out of all currently available WebXR capabilities, in that it is the only API that allows the applications to directly observe the user’s environment. Due to this, the user agents should seek user consent prior to allowing creating sessions with <a data-link-type="dfn" href="#camera-access" id="ref-for-camera-access①">camera-access</a> feature enabled. Refer to <a href="https://immersive-web.github.io/webxr/#security">WebXR Device API § security</a> &amp; <a href="https://immersive-web.github.io/webxr/#user-intention">WebXR Device API § user-intention</a> sections for more details, as well as <a href="#user-experience">§ 5.1 User experience</a> &amp; <a href="#privacy-indicators">§ 5.2 Privacy indicators</a> sections below.</p>
    <p>The requirement that the provided camera images are <a data-link-type="dfn" href="#aligned" id="ref-for-aligned②">aligned</a> with the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrview-interface" id="ref-for-xrview-interface①②">XRView</a></code>s offers a partial mitigation for impact of the API on users' privacy. A consequence of this requirement is that depending on the <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#xr-compositor" id="ref-for-xr-compositor">XR Compositor</a>’s <a data-link-type="dfn" href="https://immersive-web.github.io/webxr-ar-module/#blend-technique" id="ref-for-blend-technique">blend technique</a>, the camera image will contain the same information that the user may already be seeing, thus providing direct feedback about which parts of the environment are visible to the website. Note that in some cases it would be possible for the sites to suppress this information (e.g. on smartphones by rendering an opaque object that would encompass the entire view, thus occluding the environment rendered by the compositor).</p>
    <p>In addition to the requirement for the user agents to seek user consent, the application developers are strongly encouraged not to ask for <a data-link-type="dfn" href="#camera-access" id="ref-for-camera-access②">camera-access</a> feature if there are other means of achieving their use cases.</p>
   </section>
   <h3 class="heading settled" data-level="5.1" id="user-experience"><span class="secno">5.1. </span><span class="content">User experience</span><a class="self-link" href="#user-experience"></a></h3>
   <section class="non-normative">
    <p>As stated above, due to privacy implications of Raw Camera Access API, the user agent should seek user consent prior to creating a session with <a data-link-type="dfn" href="#camera-access" id="ref-for-camera-access③">camera-access</a> feature enabled. This can be achieved in multiple ways, some of which would require interacting with the user directly.</p>
    <p>Some examples of interacting with the user directly are:</p>
    <ol>
     <li data-md>
      <p>Displaying a permission prompt that allows the user to select how fine-grained information will be exposed to the site. Mock of such prompt can be seen below.</p>
    </ol>
    <p align="center"> <img src="img/permission-mock.png"> </p>
    <ol start="2">
     <li data-md>
      <p>Displaying a series of permission prompts that would take into consideration various levels of user consent needed in order to create a session with the requested and optional features provided by the application to <code class="idl"><a data-link-type="idl" href="https://immersive-web.github.io/webxr/#dom-xrsystem-requestsession" id="ref-for-dom-xrsystem-requestsession">requestSession()</a></code> call.</p>
    </ol>
    <p>It is the intent of this specification to ensure that the user agent does not encourage app developers to ask for <a data-link-type="dfn" href="#camera-access" id="ref-for-camera-access④">camera-access</a> feature if the experience they want to provide does not absolutely require it. Due to privacy implications of the feature, user agents are allowed to introduce additional friction when a site asks for access to the camera images, with the hopes that this would incentivize the applications to not ask for the feature needlessly.</p>
    <p>User Agents should consider re-using permissions UI (or permissions granted to the origin already) for the <a data-link-type="dfn">powerful feature</a> "<a data-link-type="dfn" href="https://www.w3.org/TR/mediacapture-streams/#dfn-camera" id="ref-for-dfn-camera">camera</a>".</p>
   </section>
   <h3 class="heading settled" data-level="5.2" id="privacy-indicators"><span class="secno">5.2. </span><span class="content">Privacy indicators</span><a class="self-link" href="#privacy-indicators"></a></h3>
   <p>The user agent MUST display a privacy indicator every time an <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webxr/#xrsession-interface" id="ref-for-xrsession-interface①">XRSession</a></code> with <a data-link-type="dfn" href="#camera-access" id="ref-for-camera-access⑤">camera-access</a> has been created and has not yet <a data-link-type="dfn">ended</a>. If it ever becomes possible to modify a <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#set-of-granted-features" id="ref-for-set-of-granted-features①">set of granted features</a> of a session after a session has been created, the indicator SHOULD be displayed for at least as long as the <a data-link-type="dfn" href="#camera-access" id="ref-for-camera-access⑥">camera-access</a> feature descriptor is <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-contain" id="ref-for-list-contain①">contained</a> in the <a data-link-type="dfn" href="https://www.w3.org/TR/webxr/#set-of-granted-features" id="ref-for-set-of-granted-features②">set of granted features</a> of the session.</p>
   <section class="non-normative-remainder">
    <p>The indicator displayed to the user should communicate the fact that the device’s camera is in-use and the site has access to it, and thus they should take extra care to ensure that the content that falls within the field of view of the camera is something they are comfortable sharing with the site. This is especially true in a public setting, where bystanders that did not consent to being recorded may be present.</p>
    <p>The example indicators consist of (but are not limited to):</p>
    <ul>
     <li data-md>
      <p>on a mobile device, displaying a notification in the status bar that the camera is in use;</p>
     <li data-md>
      <p>rendering a UI element (e.g. a border around the content, a round icon symbolizing "Record" button, etc.) that suggests that the content is being recorded;</p>
     <li data-md>
      <p>using a LED indicator of the recording device (if present and controllable by user agent);</p>
     <li data-md>
      <p>emitting a camera shutter sound effect at the start of the session;</p>
    </ul>
   </section>
   <h2 class="heading settled" data-level="6" id="ack"><span class="secno">6. </span><span class="content">Acknowledgements</span><a class="self-link" href="#ack"></a></h2>
   <p>The following individuals have contributed to the design of the WebXR Raw Camera Access specification:</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#aligned">aligned</a><span>, in § 4.1</span>
   <li><a href="#dom-xrview-camera">camera</a><span>, in § 3.1</span>
   <li><a href="#camera-access">camera-access</a><span>, in § 2.1</span>
   <li><a href="#xrcamera-camera-image">camera image</a><span>, in § 3.2</span>
   <li><a href="#create-camera-instance">create camera instance</a><span>, in § 3.2</span>
   <li><a href="#dom-xrwebglbinding-getcameraimage">getCameraImage(camera)</a><span>, in § 3.3</span>
   <li><a href="#dom-xrcamera-height">height</a><span>, in § 3.2</span>
   <li><a href="#native-camera">native camera</a><span>, in § 4.1</span>
   <li><a href="#obtain-camera">obtain camera</a><span>, in § 3.1</span>
   <li><a href="#obtain-camera-image">obtain camera image</a><span>, in § 3.3</span>
   <li><a href="#xrcamera-view">view</a><span>, in § 3.2</span>
   <li><a href="#dom-xrcamera-width">width</a><span>, in § 3.2</span>
   <li><a href="#xrcamera">XRCamera</a><span>, in § 3.2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="ae8def21">contain</span>
    </ul>
   <li>
    <a data-link-type="biblio">[MEDIA CAPTURE AND STREAMS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b44fc51d">camera</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBGL-2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4f18bcd8">WebGLTexture</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="889e932f">Exposed</span>
     <li><span class="dfn-paneled" id="797018a7">InvalidStateError</span>
     <li><span class="dfn-paneled" id="a5c91173">SameObject</span>
     <li><span class="dfn-paneled" id="b75bb3bd">SecureContext</span>
     <li><span class="dfn-paneled" id="b4cfa5ce">throw</span>
     <li><span class="dfn-paneled" id="e97a9688">unsigned long</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBXR]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="dc9c48d6">requestSession(mode)</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBXR AUGMENTED REALITY MODULE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="4a9bf0c5">blend technique</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBXR DEVICE API - LEVEL 1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="cbf14c82">XRFrame</span>
     <li><span class="dfn-paneled" id="92c48225">XRSession</span>
     <li><span class="dfn-paneled" id="b075ce09">XRView</span>
     <li><span class="dfn-paneled" id="9db6ca78">active</span>
     <li><span class="dfn-paneled" id="25c57a7c">animationFrame</span>
     <li><span class="dfn-paneled" id="00413661">capable of supporting</span>
     <li><span class="dfn-paneled" id="6779156f">feature descriptor</span>
     <li><span class="dfn-paneled" id="b12ee965">frame</span>
     <li><span class="dfn-paneled" id="e76130a4">inline XR device</span>
     <li><span class="dfn-paneled" id="5f9d262b">permissions policy</span>
     <li><span class="dfn-paneled" id="5cf83f25">requestAnimationFrame()</span>
     <li><span class="dfn-paneled" id="7e6cb546">session</span>
     <li><span class="dfn-paneled" id="87fe1306">set of granted features</span>
     <li><span class="dfn-paneled" id="a1afb5ed">time</span>
     <li><span class="dfn-paneled" id="d0d9db47">XR Compositor</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBXR LAYERS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1fe9bb6f">XRWebGLBinding</span>
     <li><span class="dfn-paneled" id="3c7fe8e0">context</span>
     <li><span class="dfn-paneled" id="cf7decf1">opaque texture</span>
     <li><span class="dfn-paneled" id="c9b54a49">session</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-webgl-2">[WEBGL-2]
   <dd>Dean Jackson; Jeff Gilbert. <a href="https://www.khronos.org/registry/webgl/specs/latest/2.0/"><cite>WebGL 2.0 Specification</cite></a>. 12 August 2017. URL: <a href="https://www.khronos.org/registry/webgl/specs/latest/2.0/">https://www.khronos.org/registry/webgl/specs/latest/2.0/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-webxr">[WEBXR]
   <dd>Brandon Jones; Manish Goregaokar; Rik Cabanier. <a href="https://immersive-web.github.io/webxr/"><cite>WebXR Device API</cite></a>. URL: <a href="https://immersive-web.github.io/webxr/">https://immersive-web.github.io/webxr/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://www.w3.org/TR/webxr/#xrview-interface"><c- g>XRView</c-></a> {
  [<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SameObject"><c- g>SameObject</c-></a>] <c- b>readonly</c-> <c- b>attribute</c-> <a data-link-type="idl-name" href="#xrcamera"><c- n>XRCamera</c-></a>? <a data-readonly data-type="XRCamera?" href="#dom-xrview-camera"><code><c- g>camera</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#SecureContext"><c- g>SecureContext</c-></a>, <a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=<c- n>Window</c->]
<c- b>interface</c-> <a href="#xrcamera"><code><c- g>XRCamera</c-></code></a> {
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a data-readonly data-type="unsigned long" href="#dom-xrcamera-width"><code><c- g>width</c-></code></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a data-readonly data-type="unsigned long" href="#dom-xrcamera-height"><code><c- g>height</c-></code></a>;
};

<c- b>partial</c-> <c- b>interface</c-> <a class="idl-code" data-link-type="interface" href="https://immersive-web.github.io/layers/#XRWebGLBindingtype"><c- g>XRWebGLBinding</c-></a> {
  <a data-link-type="idl-name" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9"><c- n>WebGLTexture</c-></a>? <a href="#dom-xrwebglbinding-getcameraimage"><code><c- g>getCameraImage</c-></code></a>(<a data-link-type="idl-name" href="#xrcamera"><c- n>XRCamera</c-></a> <a href="#dom-xrwebglbinding-getcameraimage-camera-camera"><code><c- g>camera</c-></code></a>);
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Should we specify more information about the returned <code class="idl"><a data-link-type="idl" href="https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9">WebGLTexture</a></code>? E.g.: is color-renderable, what is the texture format, etc. <a class="issue-return" href="#issue-63423cac" title="Jump to section">↵</a></div>
  </div>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"00413661": {"dfnID":"00413661","dfnText":"capable of supporting","external":true,"refSections":[{"refs":[{"id":"ref-for-capable-of-supporting"},{"id":"ref-for-capable-of-supporting\u2460"}],"title":"2.1. Feature descriptor"}],"url":"https://www.w3.org/TR/webxr/#capable-of-supporting"},
"1fe9bb6f": {"dfnID":"1fe9bb6f","dfnText":"XRWebGLBinding","external":true,"refSections":[{"refs":[{"id":"ref-for-XRWebGLBindingtype"}],"title":"3.2. XRCamera"},{"refs":[{"id":"ref-for-XRWebGLBindingtype\u2460"},{"id":"ref-for-XRWebGLBindingtype\u2461"},{"id":"ref-for-XRWebGLBindingtype\u2462"},{"id":"ref-for-XRWebGLBindingtype\u2463"}],"title":"3.3. XRWebGLBinding"}],"url":"https://immersive-web.github.io/layers/#XRWebGLBindingtype"},
"25c57a7c": {"dfnID":"25c57a7c","dfnText":"animationFrame","external":true,"refSections":[{"refs":[{"id":"ref-for-xrframe-animationframe"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-xrframe-animationframe\u2460"}],"title":"3.3. XRWebGLBinding"}],"url":"https://www.w3.org/TR/webxr/#xrframe-animationframe"},
"3c7fe8e0": {"dfnID":"3c7fe8e0","dfnText":"context","external":true,"refSections":[{"refs":[{"id":"ref-for-xrwebglbinding-context"}],"title":"3.3. XRWebGLBinding"}],"url":"https://immersive-web.github.io/layers/#xrwebglbinding-context"},
"4a9bf0c5": {"dfnID":"4a9bf0c5","dfnText":"blend technique","external":true,"refSections":[{"refs":[{"id":"ref-for-blend-technique"}],"title":"5. Privacy & Security Considerations"}],"url":"https://immersive-web.github.io/webxr-ar-module/#blend-technique"},
"4f18bcd8": {"dfnID":"4f18bcd8","dfnText":"WebGLTexture","external":true,"refSections":[{"refs":[{"id":"ref-for-5.9"},{"id":"ref-for-5.9\u2460"},{"id":"ref-for-5.9\u2461"},{"id":"ref-for-5.9\u2462"},{"id":"ref-for-5.9\u2463"},{"id":"ref-for-5.9\u2464"},{"id":"ref-for-5.9\u2465"}],"title":"3.3. XRWebGLBinding"}],"url":"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9"},
"5cf83f25": {"dfnID":"5cf83f25","dfnText":"requestAnimationFrame()","external":true,"refSections":[{"refs":[{"id":"ref-for-requestanimationframe"}],"title":"3.3. XRWebGLBinding"}],"url":"https://www.w3.org/TR/webxr/#requestanimationframe"},
"5f9d262b": {"dfnID":"5f9d262b","dfnText":"permissions policy","external":true,"refSections":[{"refs":[{"id":"ref-for-permissions-policy"},{"id":"ref-for-permissions-policy\u2460"}],"title":"2.1. Feature descriptor"}],"url":"https://www.w3.org/TR/webxr/#permissions-policy"},
"6779156f": {"dfnID":"6779156f","dfnText":"feature descriptor","external":true,"refSections":[{"refs":[{"id":"ref-for-feature-descriptor"}],"title":"2.1. Feature descriptor"}],"url":"https://www.w3.org/TR/webxr/#feature-descriptor"},
"797018a7": {"dfnID":"797018a7","dfnText":"InvalidStateError","external":true,"refSections":[{"refs":[{"id":"ref-for-invalidstateerror"},{"id":"ref-for-invalidstateerror\u2460"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-invalidstateerror\u2461"},{"id":"ref-for-invalidstateerror\u2462"},{"id":"ref-for-invalidstateerror\u2463"}],"title":"3.3. XRWebGLBinding"}],"url":"https://webidl.spec.whatwg.org/#invalidstateerror"},
"7e6cb546": {"dfnID":"7e6cb546","dfnText":"session","external":true,"refSections":[{"refs":[{"id":"ref-for-xrview-session"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-xrview-session\u2460"}],"title":"3.3. XRWebGLBinding"}],"url":"https://www.w3.org/TR/webxr/#xrview-session"},
"87fe1306": {"dfnID":"87fe1306","dfnText":"set of granted features","external":true,"refSections":[{"refs":[{"id":"ref-for-set-of-granted-features"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-set-of-granted-features\u2460"},{"id":"ref-for-set-of-granted-features\u2461"}],"title":"5.2. Privacy indicators"}],"url":"https://www.w3.org/TR/webxr/#set-of-granted-features"},
"889e932f": {"dfnID":"889e932f","dfnText":"Exposed","external":true,"refSections":[{"refs":[{"id":"ref-for-Exposed"}],"title":"3.2. XRCamera"}],"url":"https://webidl.spec.whatwg.org/#Exposed"},
"92c48225": {"dfnID":"92c48225","dfnText":"XRSession","external":true,"refSections":[{"refs":[{"id":"ref-for-xrsession-interface"}],"title":"2.1. Feature descriptor"},{"refs":[{"id":"ref-for-xrsession-interface\u2460"}],"title":"5.2. Privacy indicators"}],"url":"https://www.w3.org/TR/webxr/#xrsession-interface"},
"9db6ca78": {"dfnID":"9db6ca78","dfnText":"active","external":true,"refSections":[{"refs":[{"id":"ref-for-xrframe-active"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-xrframe-active\u2460"}],"title":"3.3. XRWebGLBinding"}],"url":"https://www.w3.org/TR/webxr/#xrframe-active"},
"a1afb5ed": {"dfnID":"a1afb5ed","dfnText":"time","external":true,"refSections":[{"refs":[{"id":"ref-for-xrframe-time"}],"title":"3.1. XRView"}],"url":"https://www.w3.org/TR/webxr/#xrframe-time"},
"a5c91173": {"dfnID":"a5c91173","dfnText":"SameObject","external":true,"refSections":[{"refs":[{"id":"ref-for-SameObject"}],"title":"3.1. XRView"}],"url":"https://webidl.spec.whatwg.org/#SameObject"},
"ae8def21": {"dfnID":"ae8def21","dfnText":"contain","external":true,"refSections":[{"refs":[{"id":"ref-for-list-contain"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-list-contain\u2460"}],"title":"5.2. Privacy indicators"}],"url":"https://infra.spec.whatwg.org/#list-contain"},
"aligned": {"dfnID":"aligned","dfnText":"aligned","external":false,"refSections":[{"refs":[{"id":"ref-for-aligned"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-aligned\u2460"}],"title":"4.1. Native camera"},{"refs":[{"id":"ref-for-aligned\u2461"}],"title":"5. Privacy & Security Considerations"}],"url":"#aligned"},
"b075ce09": {"dfnID":"b075ce09","dfnText":"XRView","external":true,"refSections":[{"refs":[{"id":"ref-for-xrview-interface"},{"id":"ref-for-xrview-interface\u2460"},{"id":"ref-for-xrview-interface\u2461"},{"id":"ref-for-xrview-interface\u2462"},{"id":"ref-for-xrview-interface\u2463"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-xrview-interface\u2464"},{"id":"ref-for-xrview-interface\u2465"}],"title":"3.2. XRCamera"},{"refs":[{"id":"ref-for-xrview-interface\u2466"},{"id":"ref-for-xrview-interface\u2467"},{"id":"ref-for-xrview-interface\u2468"},{"id":"ref-for-xrview-interface\u2460\u24ea"},{"id":"ref-for-xrview-interface\u2460\u2460"}],"title":"4.1. Native camera"},{"refs":[{"id":"ref-for-xrview-interface\u2460\u2461"}],"title":"5. Privacy & Security Considerations"}],"url":"https://www.w3.org/TR/webxr/#xrview-interface"},
"b12ee965": {"dfnID":"b12ee965","dfnText":"frame","external":true,"refSections":[{"refs":[{"id":"ref-for-xrview-frame"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-xrview-frame\u2460"}],"title":"3.3. XRWebGLBinding"}],"url":"https://www.w3.org/TR/webxr/#xrview-frame"},
"b44fc51d": {"dfnID":"b44fc51d","dfnText":"camera","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-camera"}],"title":"5.1. User experience"}],"url":"https://www.w3.org/TR/mediacapture-streams/#dfn-camera"},
"b4cfa5ce": {"dfnID":"b4cfa5ce","dfnText":"throw","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-throw"},{"id":"ref-for-dfn-throw\u2460"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-dfn-throw\u2461"},{"id":"ref-for-dfn-throw\u2462"},{"id":"ref-for-dfn-throw\u2463"}],"title":"3.3. XRWebGLBinding"}],"url":"https://webidl.spec.whatwg.org/#dfn-throw"},
"b75bb3bd": {"dfnID":"b75bb3bd","dfnText":"SecureContext","external":true,"refSections":[{"refs":[{"id":"ref-for-SecureContext"}],"title":"3.2. XRCamera"}],"url":"https://webidl.spec.whatwg.org/#SecureContext"},
"c9b54a49": {"dfnID":"c9b54a49","dfnText":"session","external":true,"refSections":[{"refs":[{"id":"ref-for-xrwebglbinding-session"}],"title":"3.3. XRWebGLBinding"}],"url":"https://immersive-web.github.io/layers/#xrwebglbinding-session"},
"camera-access": {"dfnID":"camera-access","dfnText":"camera-access","external":false,"refSections":[{"refs":[{"id":"ref-for-camera-access"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-camera-access\u2460"},{"id":"ref-for-camera-access\u2461"}],"title":"5. Privacy & Security Considerations"},{"refs":[{"id":"ref-for-camera-access\u2462"},{"id":"ref-for-camera-access\u2463"}],"title":"5.1. User experience"},{"refs":[{"id":"ref-for-camera-access\u2464"},{"id":"ref-for-camera-access\u2465"}],"title":"5.2. Privacy indicators"}],"url":"#camera-access"},
"cbf14c82": {"dfnID":"cbf14c82","dfnText":"XRFrame","external":true,"refSections":[{"refs":[{"id":"ref-for-xrframe-interface"}],"title":"3.3. XRWebGLBinding"}],"url":"https://www.w3.org/TR/webxr/#xrframe-interface"},
"cf7decf1": {"dfnID":"cf7decf1","dfnText":"opaque texture","external":true,"refSections":[{"refs":[{"id":"ref-for-opaque-texture"},{"id":"ref-for-opaque-texture\u2460"},{"id":"ref-for-opaque-texture\u2461"}],"title":"3.3. XRWebGLBinding"}],"url":"https://immersive-web.github.io/layers/#opaque-texture"},
"create-camera-instance": {"dfnID":"create-camera-instance","dfnText":" create camera instance","external":false,"refSections":[{"refs":[{"id":"ref-for-create-camera-instance"}],"title":"3.1. XRView"}],"url":"#create-camera-instance"},
"d0d9db47": {"dfnID":"d0d9db47","dfnText":"XR Compositor","external":true,"refSections":[{"refs":[{"id":"ref-for-xr-compositor"}],"title":"5. Privacy & Security Considerations"}],"url":"https://www.w3.org/TR/webxr/#xr-compositor"},
"dc9c48d6": {"dfnID":"dc9c48d6","dfnText":"requestSession(mode)","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-xrsystem-requestsession"}],"title":"5.1. User experience"}],"url":"https://immersive-web.github.io/webxr/#dom-xrsystem-requestsession"},
"dom-xrcamera-height": {"dfnID":"dom-xrcamera-height","dfnText":"height","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrcamera-height"},{"id":"ref-for-dom-xrcamera-height\u2460"}],"title":"3.2. XRCamera"}],"url":"#dom-xrcamera-height"},
"dom-xrcamera-width": {"dfnID":"dom-xrcamera-width","dfnText":"width","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrcamera-width"},{"id":"ref-for-dom-xrcamera-width\u2460"}],"title":"3.2. XRCamera"}],"url":"#dom-xrcamera-width"},
"dom-xrview-camera": {"dfnID":"dom-xrview-camera","dfnText":"camera","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrview-camera"},{"id":"ref-for-dom-xrview-camera\u2460"}],"title":"3.1. XRView"}],"url":"#dom-xrview-camera"},
"dom-xrwebglbinding-getcameraimage": {"dfnID":"dom-xrwebglbinding-getcameraimage","dfnText":"getCameraImage","external":false,"refSections":[{"refs":[{"id":"ref-for-dom-xrwebglbinding-getcameraimage"},{"id":"ref-for-dom-xrwebglbinding-getcameraimage\u2460"},{"id":"ref-for-dom-xrwebglbinding-getcameraimage\u2461"}],"title":"3.3. XRWebGLBinding"}],"url":"#dom-xrwebglbinding-getcameraimage"},
"dom-xrwebglbinding-getcameraimage-camera-camera": {"dfnID":"dom-xrwebglbinding-getcameraimage-camera-camera","dfnText":"camera","external":false,"refSections":[],"url":"#dom-xrwebglbinding-getcameraimage-camera-camera"},
"e76130a4": {"dfnID":"e76130a4","dfnText":"inline XR device","external":true,"refSections":[{"refs":[{"id":"ref-for-inline-xr-device"}],"title":"2.1. Feature descriptor"}],"url":"https://www.w3.org/TR/webxr/#inline-xr-device"},
"e97a9688": {"dfnID":"e97a9688","dfnText":"unsigned long","external":true,"refSections":[{"refs":[{"id":"ref-for-idl-unsigned-long"},{"id":"ref-for-idl-unsigned-long\u2460"}],"title":"3.2. XRCamera"}],"url":"https://webidl.spec.whatwg.org/#idl-unsigned-long"},
"native-camera": {"dfnID":"native-camera","dfnText":"native camera","external":false,"refSections":[{"refs":[{"id":"ref-for-native-camera"}],"title":"2.1. Feature descriptor"},{"refs":[{"id":"ref-for-native-camera\u2460"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-native-camera\u2461"}],"title":"4.1. Native camera"}],"url":"#native-camera"},
"obtain-camera": {"dfnID":"obtain-camera","dfnText":"obtain camera","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-camera"}],"title":"3.1. XRView"}],"url":"#obtain-camera"},
"obtain-camera-image": {"dfnID":"obtain-camera-image","dfnText":"obtain camera image","external":false,"refSections":[{"refs":[{"id":"ref-for-obtain-camera-image"},{"id":"ref-for-obtain-camera-image\u2460"}],"title":"3.3. XRWebGLBinding"}],"url":"#obtain-camera-image"},
"xrcamera": {"dfnID":"xrcamera","dfnText":"XRCamera","external":false,"refSections":[{"refs":[{"id":"ref-for-xrcamera"},{"id":"ref-for-xrcamera\u2460"},{"id":"ref-for-xrcamera\u2461"}],"title":"3.1. XRView"},{"refs":[{"id":"ref-for-xrcamera\u2462"},{"id":"ref-for-xrcamera\u2463"},{"id":"ref-for-xrcamera\u2464"},{"id":"ref-for-xrcamera\u2465"},{"id":"ref-for-xrcamera\u2466"},{"id":"ref-for-xrcamera\u2467"},{"id":"ref-for-xrcamera\u2468"}],"title":"3.2. XRCamera"},{"refs":[{"id":"ref-for-xrcamera\u2460\u24ea"},{"id":"ref-for-xrcamera\u2460\u2460"},{"id":"ref-for-xrcamera\u2460\u2461"}],"title":"3.3. XRWebGLBinding"}],"url":"#xrcamera"},
"xrcamera-camera-image": {"dfnID":"xrcamera-camera-image","dfnText":"camera image","external":false,"refSections":[{"refs":[{"id":"ref-for-xrcamera-camera-image"},{"id":"ref-for-xrcamera-camera-image\u2460"},{"id":"ref-for-xrcamera-camera-image\u2461"}],"title":"3.2. XRCamera"},{"refs":[{"id":"ref-for-xrcamera-camera-image\u2462"}],"title":"3.3. XRWebGLBinding"}],"url":"#xrcamera-camera-image"},
"xrcamera-view": {"dfnID":"xrcamera-view","dfnText":"view","external":false,"refSections":[{"refs":[{"id":"ref-for-xrcamera-view"}],"title":"3.2. XRCamera"},{"refs":[{"id":"ref-for-xrcamera-view\u2460"}],"title":"3.3. XRWebGLBinding"}],"url":"#xrcamera-view"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#aligned": {"displayText":"aligned","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"aligned","type":"dfn","url":"#aligned"},
"#camera-access": {"displayText":"camera-access","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"camera-access","type":"dfn","url":"#camera-access"},
"#create-camera-instance": {"displayText":"create camera instance","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"create camera instance","type":"dfn","url":"#create-camera-instance"},
"#dom-xrcamera-height": {"displayText":"height","export":true,"for_":["XRCamera"],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"height","type":"attribute","url":"#dom-xrcamera-height"},
"#dom-xrcamera-width": {"displayText":"width","export":true,"for_":["XRCamera"],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"width","type":"attribute","url":"#dom-xrcamera-width"},
"#dom-xrview-camera": {"displayText":"camera","export":true,"for_":["XRView"],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"camera","type":"attribute","url":"#dom-xrview-camera"},
"#dom-xrwebglbinding-getcameraimage": {"displayText":"getCameraImage(camera)","export":true,"for_":["XRWebGLBinding"],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"getCameraImage(camera)","type":"method","url":"#dom-xrwebglbinding-getcameraimage"},
"#native-camera": {"displayText":"native camera","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"native camera","type":"dfn","url":"#native-camera"},
"#obtain-camera": {"displayText":"obtain camera","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"obtain camera","type":"dfn","url":"#obtain-camera"},
"#obtain-camera-image": {"displayText":"obtain camera image","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"obtain camera image","type":"dfn","url":"#obtain-camera-image"},
"#xrcamera": {"displayText":"XRCamera","export":true,"for_":[],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"XRCamera","type":"interface","url":"#xrcamera"},
"#xrcamera-camera-image": {"displayText":"camera image","export":true,"for_":["XRCamera"],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"camera image","type":"dfn","url":"#xrcamera-camera-image"},
"#xrcamera-view": {"displayText":"view","export":true,"for_":["XRCamera"],"level":"1","normative":true,"shortname":"webxr-raw-camera-access","spec":"webxr-raw-camera-access-1","status":"local","text":"view","type":"dfn","url":"#xrcamera-view"},
"https://immersive-web.github.io/layers/#XRWebGLBindingtype": {"displayText":"XRWebGLBinding","export":true,"for_":[],"level":"","normative":true,"shortname":"webxr layers","spec":"webxr layers","status":"anchor-block","text":"XRWebGLBinding","type":"interface","url":"https://immersive-web.github.io/layers/#XRWebGLBindingtype"},
"https://immersive-web.github.io/layers/#opaque-texture": {"displayText":"opaque texture","export":true,"for_":[],"level":"","normative":true,"shortname":"webxr layers","spec":"webxr layers","status":"anchor-block","text":"opaque texture","type":"dfn","url":"https://immersive-web.github.io/layers/#opaque-texture"},
"https://immersive-web.github.io/layers/#xrwebglbinding-context": {"displayText":"context","export":true,"for_":["XRWebGLBinding"],"level":"","normative":true,"shortname":"webxr layers","spec":"webxr layers","status":"anchor-block","text":"context","type":"dfn","url":"https://immersive-web.github.io/layers/#xrwebglbinding-context"},
"https://immersive-web.github.io/layers/#xrwebglbinding-session": {"displayText":"session","export":true,"for_":["XRWebGLBinding"],"level":"","normative":true,"shortname":"webxr layers","spec":"webxr layers","status":"anchor-block","text":"session","type":"dfn","url":"https://immersive-web.github.io/layers/#xrwebglbinding-session"},
"https://immersive-web.github.io/webxr-ar-module/#blend-technique": {"displayText":"blend technique","export":true,"for_":[],"level":"","normative":true,"shortname":"webxr augmented reality module","spec":"webxr augmented reality module","status":"anchor-block","text":"blend technique","type":"dfn","url":"https://immersive-web.github.io/webxr-ar-module/#blend-technique"},
"https://immersive-web.github.io/webxr/#dom-xrsystem-requestsession": {"displayText":"requestSession(mode)","export":true,"for_":["XRSystem"],"level":"1","normative":true,"shortname":"webxr","spec":"webxr","status":"current","text":"requestSession(mode)","type":"method","url":"https://immersive-web.github.io/webxr/#dom-xrsystem-requestsession"},
"https://infra.spec.whatwg.org/#list-contain": {"displayText":"contain","export":true,"for_":["list","stack","queue","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"contain","type":"dfn","url":"https://infra.spec.whatwg.org/#list-contain"},
"https://webidl.spec.whatwg.org/#Exposed": {"displayText":"Exposed","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"Exposed","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#Exposed"},
"https://webidl.spec.whatwg.org/#SameObject": {"displayText":"SameObject","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SameObject","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SameObject"},
"https://webidl.spec.whatwg.org/#SecureContext": {"displayText":"SecureContext","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"SecureContext","type":"extended-attribute","url":"https://webidl.spec.whatwg.org/#SecureContext"},
"https://webidl.spec.whatwg.org/#dfn-throw": {"displayText":"throw","export":true,"for_":["exception"],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"throw","type":"dfn","url":"https://webidl.spec.whatwg.org/#dfn-throw"},
"https://webidl.spec.whatwg.org/#idl-unsigned-long": {"displayText":"unsigned long","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"unsigned long","type":"interface","url":"https://webidl.spec.whatwg.org/#idl-unsigned-long"},
"https://webidl.spec.whatwg.org/#invalidstateerror": {"displayText":"InvalidStateError","export":true,"for_":[],"level":"1","normative":true,"shortname":"webidl","spec":"webidl","status":"current","text":"InvalidStateError","type":"exception","url":"https://webidl.spec.whatwg.org/#invalidstateerror"},
"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9": {"displayText":"WebGLTexture","export":true,"for_":[],"level":"","normative":true,"shortname":"webgl","spec":"webgl","status":"anchor-block","text":"WebGLTexture","type":"interface","url":"https://www.khronos.org/registry/webgl/specs/latest/1.0/#5.9"},
"https://www.w3.org/TR/mediacapture-streams/#dfn-camera": {"displayText":"camera","export":true,"for_":[],"level":"","normative":true,"shortname":"media capture and streams","spec":"media capture and streams","status":"anchor-block","text":"camera","type":"dfn","url":"https://www.w3.org/TR/mediacapture-streams/#dfn-camera"},
"https://www.w3.org/TR/webxr/#capable-of-supporting": {"displayText":"capable of supporting","export":true,"for_":[],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"capable of supporting","type":"dfn","url":"https://www.w3.org/TR/webxr/#capable-of-supporting"},
"https://www.w3.org/TR/webxr/#feature-descriptor": {"displayText":"feature descriptor","export":true,"for_":[],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"feature descriptor","type":"dfn","url":"https://www.w3.org/TR/webxr/#feature-descriptor"},
"https://www.w3.org/TR/webxr/#inline-xr-device": {"displayText":"inline XR device","export":true,"for_":[],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"inline xr device","type":"dfn","url":"https://www.w3.org/TR/webxr/#inline-xr-device"},
"https://www.w3.org/TR/webxr/#permissions-policy": {"displayText":"permissions policy","export":true,"for_":[],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"permissions policy","type":"dfn","url":"https://www.w3.org/TR/webxr/#permissions-policy"},
"https://www.w3.org/TR/webxr/#requestanimationframe": {"displayText":"requestAnimationFrame()","export":true,"for_":["XRSession"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"requestanimationframe()","type":"dfn","url":"https://www.w3.org/TR/webxr/#requestanimationframe"},
"https://www.w3.org/TR/webxr/#set-of-granted-features": {"displayText":"set of granted features","export":true,"for_":["XRSession"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"set of granted features","type":"dfn","url":"https://www.w3.org/TR/webxr/#set-of-granted-features"},
"https://www.w3.org/TR/webxr/#xr-compositor": {"displayText":"XR Compositor","export":true,"for_":[],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"xr compositor","type":"dfn","url":"https://www.w3.org/TR/webxr/#xr-compositor"},
"https://www.w3.org/TR/webxr/#xrframe-active": {"displayText":"active","export":true,"for_":["XRFrame"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"active","type":"dfn","url":"https://www.w3.org/TR/webxr/#xrframe-active"},
"https://www.w3.org/TR/webxr/#xrframe-animationframe": {"displayText":"animationFrame","export":true,"for_":["XRFrame"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"animationframe","type":"dfn","url":"https://www.w3.org/TR/webxr/#xrframe-animationframe"},
"https://www.w3.org/TR/webxr/#xrframe-interface": {"displayText":"XRFrame","export":true,"for_":[],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"XRFrame","type":"interface","url":"https://www.w3.org/TR/webxr/#xrframe-interface"},
"https://www.w3.org/TR/webxr/#xrframe-time": {"displayText":"time","export":true,"for_":["XRFrame"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"time","type":"dfn","url":"https://www.w3.org/TR/webxr/#xrframe-time"},
"https://www.w3.org/TR/webxr/#xrsession-interface": {"displayText":"XRSession","export":true,"for_":[],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"XRSession","type":"interface","url":"https://www.w3.org/TR/webxr/#xrsession-interface"},
"https://www.w3.org/TR/webxr/#xrview-frame": {"displayText":"frame","export":true,"for_":["XRView"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"frame","type":"dfn","url":"https://www.w3.org/TR/webxr/#xrview-frame"},
"https://www.w3.org/TR/webxr/#xrview-interface": {"displayText":"XRView","export":true,"for_":[],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"XRView","type":"interface","url":"https://www.w3.org/TR/webxr/#xrview-interface"},
"https://www.w3.org/TR/webxr/#xrview-session": {"displayText":"session","export":true,"for_":["XRView"],"level":"","normative":true,"shortname":"webxr device api - level 1","spec":"webxr device api - level 1","status":"anchor-block","text":"session","type":"dfn","url":"https://www.w3.org/TR/webxr/#xrview-session"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const refHintKey = link.getAttribute("data-refhint-key");
    let key = url;
    if(refHintKey) {
        key = refHintKey + "_" + url;
    }
    const ref = refsData[key];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>